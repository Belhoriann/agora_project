<body>
  
<% if user_signed_in? %>
<!-- Do stuff if the user is logged --->
<% end %>

<div class="container-fluid">
  <div class="form-inline">
    <h4 class="p-2">FEATURED</h4>
    <small class="text-muted">Whet Your Curiosity</small>
  </div>
  <div class="row p-2" style="height: 100%">
    <div class="col-lg-4" style="padding: 0px">
      <% Article.order(:cached_scoped_praise_votes_total => :desc).first(1).each do |article| %>
        <%= render 'layouts/vcard_featured_full', article: article %>  
      <% end %>
    </div>
    <div class="col-md">
      <div class="row">
        <div class="col-sm">
          <% Article.order(:cached_scoped_praise_votes_total => :desc).sample(1).each do |article| %>
            <%= render 'layouts/vcard_featured_compact', article: article %>  
          <% end %>
        </div>
      
        <div class="col-sm" style="padding: 0px">
          <% Article.order(:cached_scoped_praise_votes_total => :desc).sample(1).each do |article| %>
            <%= render 'layouts/vcard_featured_compact', article: article %>  
          <% end %>
        </div>
      </div>

      <div class="row p-0">
        <div class="col-sm">
          <% Article.order(:cached_scoped_praise_votes_total => :desc).sample(1).each do |article| %>
            <%= render 'layouts/vcard_featured_compact', article: article %>  
          <% end %>
        </div>
        
        <div class="col-sm" style="padding: 0px">
          <% Article.order(:cached_scoped_praise_votes_total => :desc).sample(1).each do |article| %>
            <%= render 'layouts/vcard_featured_compact', article: article %>  
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="container-fluid">
  <div class="form-inline">
    <h4 class="p-2">YOU MAY LIKE</h4>
    <small class="text-muted">Most Upvoted Articles</small>
  </div>
  <div class="d-flex flex-row dragscroll" style="overflow: auto;">
    <% Article.order(:cached_scoped_praise_votes_total => :desc).first(7).each do |article| %>
    <div class="card" style="min-width: 300px; margin-right: 10px">
      <img class="card-img-middle img-fluid" src="//placehold.it/720x350" alt="Card image cap">
      <div class="card-body pb-0">
        <div class="row">
          <small class="col text-muted">
            <i class="far fa-clock"></i>
            <%= article.created_at.strftime("%b %d") %> - 
            <%= link_to Category.find(article.category_id).name, category_path(article.category_id) %>
            <% if user_signed_in? && current_user.id == article.user_id %>
              | <%= link_to "Edit", edit_article_path(article) %>
            <% end %>
          </small>
          <%#= article.cached_votes_total %>
          <div class="col-2 bookmarking">
            <% if user_signed_in? %>
              <% if current_user.liked? article, vote_scope: 'bookmark' %>
                <%= link_to unbookmark_article_path(article), remote: true, id: "unlike_#{article.id}", method: :put do %>
                  <i class="material-icons">bookmark</i>
                <% end %>
              <% else %>
                <%= link_to bookmark_article_path(article), remote: true, id: "like_#{article.id}", method: :put do %>
                  <i class="material-icons">bookmark_border</i>
                <% end %>
              <% end %>
            <% end %>
          </div> 
        </div>
        <%= link_to article_path(article), class: "card-link" do %>
        <strong class="d-flex card-title pb-1"><%= article.title %></strong>
        <small class="d-flex card-subtitle"><%= article.sub_title %></small>
        <% end %>
      </div>
      <div class="d-flex flex-row justify-content-end p-2">
        <div class="">
          <i class="fas fa-heart"></i>
          <small class="pr-2 vote-count"><%= article.find_votes_for(:vote_scope => 'praise').size.to_s %></small>
        </div>
        <div class="">
          <i class="fas fa-comment-alt"></i>
          <small class="pr-2 vote-count"><%= "x" %></small>
        </div> 
      </div>
      <div class="card-footer bg-transparent">
        <div class="form-inline">
          <% author_avatar = User.find(article.user_id) %>
          <% if author_avatar.avatar != nil %>
          <div class="pr-2">
            <%= image_tag(author_avatar.avatar.url(:thumb), class:"rounded-circle border border-secondary", style: "height: 60px; width: 60px;") %>
          </div>
          <% end %>
          <div class="align-items-middle">
            <h6 class="author"><%= link_to article.author, user_path(article.user_id, full_name: article.author) %></h6>
            <p class="author"><%= article.author_work_place %></p>
          </div>
        </div>
      </div>
    </div>    
    <% end %>
  </div>
</div>    

<br><br />

<!--JUMBOTRON!-->
<div class="jumbotron jumbotron-fluid p-4">
  <div class="container" align="center">
    <h1 class="display-4">Your research meets the world</h1>
    <h3 class="lead">You are a scientist, an engineer or a student? Share your knowledge by writing engaging articles.</h3>
    <% if user_signed_in? %>
        <%= button_to "Start Writing", new_article_path, class: "btn btn-outline-light mt-4", :method => :get %>      
    <% else %>
        <%= button_to "Sign Up & Start Writing", new_user_registration_path, class: "btn btn-outline-light mt-4", :method => :get %>
    <% end %>
  </div>
</div>
<!--JUMBOTRON!-->

<div class="container-fluid" style="max-width: 1400px">
  <div class="d-flex align-items-end">
    <h4 class="p-2 mb-0">LATEST ARTICLES</h4>
    <small class="pb-2 text-muted">The state of the art</small>
  </div>
  
  <div class="row justify-content-center">
    <% @categories = Category.all %>
    <% @categories.order(:name).each do |cat| %>
      <div class="col-lg-6">
        <div class="p-1 form-inline">
          <!--category_icon is a helper method inside application_helper-->
          <% cat_icon = category_icon(Category.find(cat.id).name) %> 
          <%= button_to category_path(cat.id), method: :get, class:"btn btn-cat btn-outline-dark" do %>
          <i class="<%= cat_icon %>"></i>
          <%= Category.find(cat.id).name %>
          <% end %>
        </div>
      <% Article.where(category_id: cat.id).each do |article| %>
        <%= render 'layouts/hcard_home', article: article %>
      <% end %>
      </div> 
    <% end %>
  </div>
</div>


</body>
</html>

<%#= link_to "UBM",  bookmark,  method: :delete, id: bookmark.id, data: { confirm: 'Are you sure?', remote: true }, class: "btn btn-danger btn-sm", role: "button" %> 
<%# if Bookmark.find_by(:user_id => current_user.id, :article_id => article.id) == nil %>
<%#= link_to "BM", bookmarks_path(:user_id => current_user.id, :article_id => article.id), :method => :post, class: "btn btn-primary btn-sm", role: "button" %>
